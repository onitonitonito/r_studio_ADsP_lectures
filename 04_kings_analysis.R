rm(list=ls())
getwd()

##-----------------------------------------------------------------------------
## chpt 3. time series
##-----------------------------------------------------------------------------


#install.packages("TTR")
library(TTR)

#install.packages("forecast")
library(forecast)


#------------------------------------------------------------------
# decompose non-seasonal data
# ???? ?յ??? ???��? ???? ??????
#------------------------------------------------------------------


kings <- c(60, 43, 67, 50, 56, 42, 50, 65, 68, 43,
           65, 34, 47, 34, 49, 41, 13, 35, 53, 56,
           16, 43, 69, 59, 48, 59, 86, 55, 68, 51,
           33, 49, 67, 77, 81, 67, 71, 81, 68, 70,
           77, 56)

### ----------------------------------------------------------------
#kings <- read.table("http://robjhyndman.com/tsdldata/misc/kings.dat", header=TRUE, sep=",",
#                   stringsAsFactors=FALSE, na.strings=c('NIL'),
#                   comment.char="#", encoding="UTF-8")
#kings <- scan("http://robjhyndman.com/tsdldata/misc/kings.dat")
#write.table(data, file="data/data.csv", append=FALSE, quote=FALSE, sep=",", row.names=FALSE)
### ----------------------------------------------------------------

kingstimeseries <- ts(kings)            #ts?Լ??? Ȱ???Ͽ? ?????͸? ?ð迭?????ͷ? ??ȯ

"____ (SET) TIME SERIES DATA ___
Time Series:
Start = 1
End = 42
Frequency = 1
"
kingstimeseries
head(kingstimeseries)
summary(kingstimeseries)

plot.ts(kingstimeseries)                #plot.ts ?Լ??? Ȱ???Ͽ? ?ð迭?????͸? ????ȭ


#SMA ?Լ??? ?̿??? ?????? ?ð迭?? Ʈ???带 ?????ִ? ???ؽð迭?? ?̵????? ?׷??? ?׸???
kingstimeseriesSMA3 <- SMA(kingstimeseries,n=3)
plot.ts(kingstimeseriesSMA3)

kingstimeseriesSMA8<-SMA(kingstimeseries,n=8)
plot.ts(kingstimeseriesSMA8)

kingstimeseriesSMA12<-SMA(kingstimeseries,n=12)
plot.ts(kingstimeseriesSMA12)

par(mfrow=c(2,2))                        #?ϳ??? ?׷??? ȭ?鿡 ?Բ? ǥ???ϱ?
plot.ts(kingstimeseries)
plot.ts(kingstimeseriesSMA3)
plot.ts(kingstimeseriesSMA8)
plot.ts(kingstimeseriesSMA12)


#?????Ͽ? ��???? Ȯ???ϱ? (difference)
# diff ?Լ??? Ȱ???Ͽ? ?????? ?????ϱ?

kingstimeseriesdiff1 <- diff(kingstimeseries, differences = 1)
kingstimeseriesdiff2 <- diff(kingstimeseries, differences = 2)
kingstimeseriesdiff3 <- diff(kingstimeseries, differences = 3)
kingstimeseriesdiff1
kingstimeseriesdiff2
kingstimeseriesdiff3


par(mfrow=c(2,2))
plot.ts(kingstimeseriesdiff1)           #1?? ?????? ????, ???հ? ?л??? ?ð??? ??��???? ??��
plot.ts(kingstimeseriesdiff2)
plot.ts(kingstimeseriesdiff3)


mean(kingstimeseriesdiff1)
sd(kingstimeseriesdiff1)

mean(kingstimeseriesdiff2)
sd(kingstimeseriesdiff2)

mean(kingstimeseriesdiff3)
sd(kingstimeseriesdiff3)



# ARIMA ???? ??��?ϱ? ARIMA(p, 1, q)

# acf?Լ??? pacf ?Լ??? ?????Ͽ? ???? ??��?ϱ?

par(mfrow=c(2,2))
acf(kingstimeseriesdiff1, lag.max=20)          #1?? ?????? ?????ͷ? (ACF) Ȯ??
acf(kingstimeseriesdiff1, lag.max=20)
#--- lag = 0 ??���� ???? ??��
#--- lag = 1 ?? ??��?? ��?? ?????ۿ? ??��
#--- lag = 2 ?? ??��???? ???? ��?? ?????ȿ? ??�� lag?? 2???? ????���� ???? -> MA(1)????


pacf(kingstimeseriesdiff1, lag.max=20)         #1?? ?????? ?????ͷ? (PACF) Ȯ??
pacf(kingstimeseriesdiff1, lag.max=20)
#pacf(kingstimeseriesdiff1, lag.max=20, plot=FALSE)
#--- lag = 0 ??���� ?ڷ? ??��
#--- lag = 1, 2, 3 ??��?? ��?? ?????ۿ? ??��
#--- lag = 4 ?? ??��???? ???? ��?? ?????ȿ? ??�� lag?? 4???? ????���� ???? -> AR(3) 모형



# forecast package ?? ?????? auto.arima ?Լ??? ?̿??? ???? ã??

auto.arima(kings)
#--- ARIMA(0, 1, 1) �� ???? ?????? ????��?? ????


#  ARIMA ????�� ???? ?̷? ?????ϱ?
# ARIMA????��?? ?????? ??��?ϱ?(fitting)

kingstimeseriesARIMA<- arima(kingstimeseries, order=c(0, 1, 1))
kingstimeseriesARIMA

# forecast.Arima ?Լ??? ???? ?̷? ?????ϱ?

kingstimeseriesforecasts<-forecast(kingstimeseriesARIMA)
kingstimeseriesforecasts

# 5??�� ?????ϰ??? ?Ѵٸ? h=5?? ??��????

kingstimeseriesforecasts<-forecast(kingstimeseriesARIMA,h=5)
kingstimeseriesforecasts

# ?̷? ?????? ???? ??ǥ ?׸???

par(mfrow=c(1,1))
plot(kingstimeseriesforecasts)
